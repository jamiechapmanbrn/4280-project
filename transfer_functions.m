aI = 0.47625^2 * pi()/4;
aT = 4.445^2 * pi()/4;
o = (2 * 981)^ 0.5 * aI / aT;
gamma = [0.9005, 0.8658; 1-0.8658, 1-0.9005];
kp = [4.2839,5.2407];
m = [kp(1)*gamma(1,1)/aT, kp(2)*gamma(1,2)/aT;
     kp(2)*gamma(2,1)/aT, kp(1)*gamma(2,2)/aT;];
 
v = [6.743 6.012];
h = [(m(1,1)*v(1)/o)^2, (m(1,2)*v(2)/o)^2;
     (m(1,1)*v(1)/o+m(2,1)*v(2)/o)^2, (m(2,2)*v(1)/o+m(1,2)*v(2)/o)^2;];
 
y1 = h(1,1)+h(2,1);
y2 = h(1,2)+h(2,2);

s = tf('s');

y1v1 = (2*m(1,1)*(h(1,1)^0.5+h(2,1)^0.5)/o) ...
      *((2*h(1,1)^0.5*h(2,1)^0.5)/(o*(h(1,1)^0.5+h(2,1)^0.5))*s +1) ...
      /(2*h(1,1)^0.5/o*s +1)  ...
      /(2*h(2,1)^0.5/o*s +1);

y1v2 = (2*m(2,1)*h(2,1)^0.5/o) ...
      /(2*h(2,1)^0.5/o*s +1);
  
y2v1 = (2*m(2,2)*h(2,1)^0.5/o) ...
      /(2*h(2,2)^0.5/o*s +1);
      
y2v2 = (2*m(1,2)*(h(1,2)^0.5+h(2,2)^0.5)/o)  ...
      *((2*h(1,2)^0.5*h(2,2)^0.5)/(o*(h(1,2)^0.5+h(2,2)^0.5))*s +1) ...
      /(2*h(1,2)^0.5/o*s +1)  ...
      /(2*h(2,2)^0.5/o*s +1);
  
y = [y1v1, y1v2; y2v1, y2v2;];

h11 = [(m(1,1)*2*h(1,1)^0.5/o)/(2*h(1,1)^0.5/o*s +1) 0];

h12 = [0 (m(1,2)*2*h(1,2)^0.5/o)/(2*h(1,2)^0.5/o*s +1) ];

h21 = [(m(1,1)*2*h(2,1)^0.5/o)/(2*h(2,1)^0.5/o*s +1)/(2*h(1,1)^0.5/o*s +1) (m(2,1)*2*h(2,1)^0.5/o)/(2*h(2,1)^0.5/o*s +1)];

h22 = [(m(2,2)*2*h(2,2)^0.5/o)/(2*h(2,2)^0.5/o*s +1) (m(1,2)*2*h(2,2)^0.5/o)/(2*h(2,2)^0.5/o*s +1)/(2*h(1,2)^0.5/o*s +1)];

A = [ -o/(2*h(1,1)^0.5) 0 0 0;
      0 -o/(2*h(1,2)^0.5) 0 0;
      o/(2*h(1,1)^0.5) 0 -o/(2*h(2,1)^0.5) 0;
      0 o/(2*h(1,2)^0.5) 0 -o/(2*h(2,2)^0.5);];
  
B = [m(1,1) 0;
     0 m(1,2);
     m(2,1) 0;
     0 m(2,2);];
 
C = [ 0 0 0 0;
      0 0 0 0;
      0 0 1 0;
      0 0 0 1;];
 
D = [ 0 0;
      0 0;
      0 0;
      0 0;];

lowerYss = ss(A,B,C,D);

[k p e] = lqr(lowerYss, C, eye(2));

lowerYlqr = ss(A-B*k,B,C,D);