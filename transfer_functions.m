% provide system values
aI = 0.47625^2 * pi()/4;
aT = 4.445^2 * pi()/4;
o = (2 * 981)^ 0.5 * aI / aT;

% observed equilbrium point
v = [6, 6];
hObs = [3.5, 4.5; 8.6, 8.5];

% calculated system values
hRoot = [hObs(1,1)^0.5, hObs(1,2)^0.5;
         hObs(2,1)^0.5, hObs(2,2)^0.5];
m = [hRoot(1,1)*o/v(1), hRoot(1,2)*o/v(2);
    (hRoot(2,1)-hRoot(1,1))*o/v(2), (hRoot(2,2)-hRoot(1,2))*o/v(1)];
h = [(m(1,1)*v(1)/o)^2, (m(1,2)*v(2)/o)^2;
     (m(1,1)*v(1)/o+m(2,1)*v(2)/o)^2, (m(2,2)*v(1)/o+m(1,2)*v(2)/o)^2;];
kp = [aT*(m(1,1)+m(2,2)), aT*(m(1,2)+m(2,1))];

gamma = [m(1,1)*aT/kp(1), m(1,2)*aT/kp(2);
         m(2,1)*aT/kp(2), m(2,2)*aT/kp(1)];

s = tf('s');

h11 = [ 2.16/(2*h(1,1)^0.5/o*s +1) 0];

h12 = [0 (2.85)/(2*h(1,2)^0.5/o*s +1) ];

h21 = [(m(1,1)*2*h(2,1)^0.5/o)/(2*h(2,1)^0.5/o*s +1)/(2*h(1,1)^0.5/o*s +1) (m(2,1)*2*h(2,1)^0.5/o)/(2*h(2,1)^0.5/o*s +1)];

h22 = [(m(2,2)*2*h(2,2)^0.5/o)/(2*h(2,2)^0.5/o*s +1) (m(1,2)*2*h(2,2)^0.5/o)/(2*h(2,2)^0.5/o*s +1)/(2*h(1,2)^0.5/o*s +1)];

overtf = [h11;h12;h21;h22]


A = [ -o/(2*h(1,1)^0.5) 0 0 0;
      0 -o/(2*h(1,2)^0.5) 0 0;
      o/(2*h(1,1)^0.5) 0 -o/(2*h(2,1)^0.5) 0;
      0 o/(2*h(1,2)^0.5) 0 -o/(2*h(2,2)^0.5);];
  
B = [m(1,1) 0;
     0 m(1,2);
     m(2,1) 0;
     0 m(2,2);];
 
C = [ 0 0 0 0;
      0 0 0 0;
      0 0 1 0;
      0 0 0 1;];
 
D = [ 0 0;
      0 0;
      0 0;
      0 0;];

yTF = minreal([h21;h22]);

ySS = ss(A,B,C,D);

transmissionZeros = tzero(yTF);


d12 = -yTF(1,2)/ yTF(1,1)
d21 = -yTF(2,1)/ yTF(2,2)

s = tf('s')


c1 = 0.5336 + 0.0463/s
c2 = 0.40219 + 0.0351/s

ctf = [c1 0 ; 0 , c2 ]

out = zpk(minreal((ctf * yTF )/( 1 + ctf * yTF ),0.001))


% G = zpk(yTF * [ 1/12.5,0; 0, 1/12.5 ] * [7,0;0,7]);
% 
% [U,S,V] = svd(dcgain(G))
